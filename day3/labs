## Lab1

# Create template, instances group, instances, firewall, provision script

gcloud config set compute/zone europe-west1-c
gcloud config set compute/region europe-west1

cat << EOF > startup.sh
#! /bin/bash
apt-get update
apt-get install -y nginx
service nginx start
sed -i -- 's/nginx/Google Cloud Platform - '"\$HOSTNAME"'/' /var/www/html/index.nginx-debian.html
EOF

gcloud compute instance-templates create nginx-template \
         --metadata-from-file startup-script=startup.sh

gcloud compute target-pools create nginx-pool

gcloud compute instance-groups managed create nginx-group \
         --base-instance-name nginx \
         --size 2 \
         --template nginx-template \
         --target-pool nginx-pool

# gcloud compute instances list

gcloud compute firewall-rules create www-firewall --allow tcp:80

# Create LB rules, LB

gcloud compute forwarding-rules create nginx-lb \
         --port-range 80 \
         --target-pool nginx-pool

# <<< 11 europe-west1

gcloud compute http-health-checks create http-basic-check

# Forward traffic

gcloud compute instance-groups managed \
      set-named-ports nginx-group \
      --named-ports http:80

# Create a backend service
# FAILED

gcloud compute backend-services create nginx-backend \
      --protocol HTTP --http-health-check http-basic-check

## Lab2

mkdir networking101

cd networking101

gsutil cp gs://networking101/* .

gcloud deployment-manager deployments create networking101  \
--config networking-lab.yaml

# Update firewall rules

cat networking-lab-snippet.yaml >> networking-lab.yaml 

# update deployment

gcloud deployment-manager deployments update networking101 \
--config networking-lab.yaml

# Update firewall rules

gcloud compute firewall-rules create nw101-allow-http \
--allow tcp:80 --network networking101 --source-ranges 0.0.0.0/0 \
--target-tags http-server

# Create instance template

gcloud compute instance-templates create "us-east1-template" \
--subnet "us-east1" \
--metadata "startup-script-url=gs://networking101-lab/startup.sh" \
--region "us-east1" \
--tags "http-server"

# Create another template

gcloud compute instance-templates create "europe-west1-template" \
--subnet "europe-west1" \
--metadata "startup-script-url=gs://networking101-lab/startup.sh" \
--region "europe-west1" \
--tags "http-server"

## Create instance groups manually
